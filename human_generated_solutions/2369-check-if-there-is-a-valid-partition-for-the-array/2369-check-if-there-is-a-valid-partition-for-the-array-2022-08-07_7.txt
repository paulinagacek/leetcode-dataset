class Solution:
    def validPartition(self, nums: List[int]) -> bool:
        n = len(nums)

        @cache
        def go(ind):
            if ind == n:
                return True
            
            count = 3
            prev = None
            sol1 = sol2 = sol3 = sol4 = False
            sol4_flag = True
            
            while count and ind < n:
                count -= 1
                if prev is None:
                    prev = nums[ind]

                elif nums[ind] == prev:
                    if count == 1:
                        sol1 = go(ind + 1)

                elif nums[ind] != prev:
                    sol4_flag = False
                    if count == 0:
                        sol2 = go(ind)

                    else:
                        count = 2
                        bf = 0
                        while count and ind < n:
                            count -= 1
                            if nums[ind] - prev != 1:
                                bf = 1
                                break
                            prev = nums[ind]
                            ind += 1

                        if count == bf == 0:
                            sol3 = go(ind)

                        break

                prev = nums[ind]
                ind += 1

            if sol4_flag and count == 0:
                sol4 = go(ind)

            if sol1 or sol2 or sol4 or sol3:
                return True
            return False

        return go(0)