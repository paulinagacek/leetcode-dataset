class Solution:
    def prisonAfterNDays(self, cells: List[int], N: int) -> List[int]:
        cells = tuple(cells)  # For hash-able
        c2d = {}              # Cells to date mapping
        states = []           # Sequentially record the cell states everyday
        day = 0               # Day counter
        
        while cells not in c2d:
            if day == N:
                return cells
				
            states += [cells]
            c2d[cells] = day
			
			# Calculate the next state of cells 
            cells = tuple([0]+[1 if cells[i-1] == cells[i+1] else 0 for i in range(1,len(cells)-1)]+[0])
            day += 1
        
        loopStartDate = c2d[cells]          # Get the offset to repeating part
        loopLength = day - loopStartDate    # Get the cycle length
        return states[loopStartDate + (N - loopStartDate) % loopLength]