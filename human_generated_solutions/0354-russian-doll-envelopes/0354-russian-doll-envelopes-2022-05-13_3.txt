class Solution:
    def maxEnvelopes(self, envelopes: List[List[int]]) -> int:
        # sort the width by ascending order, the height by descending order
        envelopes.sort(key=lambda x: (x[0], -x[1]))
        tops = []
        for e in envelopes:
            if tops and tops[-1][0] < e[0] and tops[-1][1] < e[1]: 
                # To speed up, if height and width is bigger than the envelope in our piles, create a new pile
                tops.append(e)
                continue

            for i in range(len(tops)):
                if tops[i][1] >= e[1]: 
                    # if envelope is smaller than top envelope of pile, update top envelope of pile
                    tops[i] = e
                    break
            else:
                # not trigger break (height and width is bigger than the envelope in our piles, create a new pile)
                tops.append(e)
        return len(tops)