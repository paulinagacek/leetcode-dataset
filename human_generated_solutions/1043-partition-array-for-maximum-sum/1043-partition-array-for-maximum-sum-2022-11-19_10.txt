class Solution:
    def maxSumAfterPartitioning(self, arr: List[int], k: int) -> int:
        n = len(arr)
        
        @functools.lru_cache(None)
        def dfs(i):
            if i == n: return 0
            
            res = -float(\'inf\')
            for j in range(i, min(i+k, n)): # O(k^2) because max(arr[i:j+1]) is O(k)
                res = max(res, dfs(j+1) + max(arr[i:j+1]) * (j-i+1))
            return res
        return dfs(0)