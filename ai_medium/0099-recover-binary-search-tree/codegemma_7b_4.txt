class Solution:
    def recoverTree(self, root: Optional[TreeNode]) -> None:
        prev = first = second = None
        cur = root

        while cur:
            if cur.left:
                temp = cur.left
                while temp.right and temp.right != cur:
                    temp = temp.right
                if not temp.right:
                    temp.right = cur
                    cur = cur.left
                else:
                    temp.right = None
                    if not first:
                        first = prev
                    second = cur
                    cur = cur.right
            else:
                prev = cur
                cur = cur.right

        first.val, second.val = second.val, first.val
