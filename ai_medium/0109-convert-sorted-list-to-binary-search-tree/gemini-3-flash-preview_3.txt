class Solution:
    def sortedListToBST(self, head: Optional[ListNode]) -> Optional[TreeNode]:
        # Count the total number of nodes in the linked list
        n, curr = 0, head
        while curr:
            n += 1
            curr = curr.next
        
        # Recursive function to build the BST using in-order simulation
        def convert(start, end):
            nonlocal head
            if start > end:
                return None
            
            mid = (start + end) // 2
            
            # Step 1: Recursively build the left subtree
            left_subtree = convert(start, mid - 1)
            
            # Step 2: Create the root node for the current range using the current linked list head
            root = TreeNode(head.val)
            head = head.next
            
            # Step 3: Assign the left subtree to the root
            root.left = left_subtree
            
            # Step 4: Recursively build and assign the right subtree
            root.right = convert(mid + 1, end)
            
            return root
        
        # Build the BST from the range [0, n-1]
        return convert(0, n - 1)
