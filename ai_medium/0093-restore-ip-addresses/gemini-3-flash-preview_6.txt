class Solution:
    def restoreIpAddresses(self, s: str) -> List[str]:
        res = []
        n = len(s)
        # A valid IP address has between 4 and 12 digits.
        if n < 4 or n > 12:
            return res
        
        def backtrack(start: int, path: List[str]):
            # Base case: if we have found 4 parts.
            if len(path) == 4:
                # If we have also consumed all digits in s, we found a valid IP address.
                if start == n:
                    res.append(".".join(path))
                return
            
            # Explore each possible segment length (1, 2, or 3).
            for length in range(1, 4):
                # Ensure we don't go out of bounds of the string.
                if start + length <= n:
                    segment = s[start:start + length]
                    
                    # Rule 1: No leading zeros allowed unless the segment is exactly "0".
                    if len(segment) > 1 and segment[0] == '0':
                        continue
                    
                    # Rule 2: Each integer segment must be between 0 and 255 inclusive.
                    if int(segment) <= 255:
                        path.append(segment)
                        backtrack(start + length, path)
                        # Backtrack to explore other possibilities.
                        path.pop()
        
        backtrack(0, [])
        return res
