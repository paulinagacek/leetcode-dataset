class Solution:
    def restoreIpAddresses(self, s: str) -> List[str]:
        res = []
        n = len(s)
        # An IP address has 4 parts, each with 1 to 3 digits.
        # Max length is 4 * 3 = 12, min length is 4 * 1 = 4.
        if n < 4 or n > 12:
            return res

        def isValid(segment):
            # Check for leading zeros: "0" is valid, "01", "001" are invalid.
            if len(segment) > 1 and segment[0] == '0':
                return False
            # Check if the segment is within the valid range [0, 255].
            if int(segment) > 255:
                return False
            return True

        # Iterate through possible lengths for the first three parts.
        # i, j, k, l are the lengths of the four segments.
        for i in range(1, 4):
            for j in range(1, 4):
                for k in range(1, 4):
                    l = n - i - j - k
                    # The length of the fourth part must also be between 1 and 3.
                    if 1 <= l <= 3:
                        s1 = s[0:i]
                        s2 = s[i:i+j]
                        s3 = s[i+j:i+j+k]
                        s4 = s[i+j+k:]
                        # If all segments are valid, format the IP address and add it to the result.
                        if isValid(s1) and isValid(s2) and isValid(s3) and isValid(s4):
                            res.append(s1 + "." + s2 + "." + s3 + "." + s4)
        
        return res
