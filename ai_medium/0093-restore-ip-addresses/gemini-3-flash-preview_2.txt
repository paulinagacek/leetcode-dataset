class Solution:
    def restoreIpAddresses(self, s: str) -> List[str]:
        n = len(s)
        # A valid IP address has at most 4 sections of 3 digits each (12 digits total).
        if n > 12:
            return []
        
        res = []
        
        def backtrack(start, path):
            # If we have partitioned exactly 4 sections
            if len(path) == 4:
                # If we have also reached the end of the string, it is a valid IP
                if start == n:
                    res.append(".".join(path))
                return
            
            # Pruning: if the remaining characters are too many or too few to form valid segments
            remaining_sections = 4 - len(path)
            if (n - start) > remaining_sections * 3 or (n - start) < remaining_sections:
                return
            
            # Try segments of lengths 1, 2, and 3
            for length in range(1, 4):
                if start + length > n:
                    break
                
                segment = s[start:start+length]
                
                # Check for leading zero: a segment can't have more than 1 digit if it starts with '0'
                if length > 1 and segment[0] == '0':
                    continue
                
                # Check if segment value is within the valid range [0, 255]
                if int(segment) <= 255:
                    path.append(segment)
                    backtrack(start + length, path)
                    path.pop()
        
        backtrack(0, [])
        return res
