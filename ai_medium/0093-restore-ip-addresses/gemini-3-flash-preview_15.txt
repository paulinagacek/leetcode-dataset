class Solution:
    def restoreIpAddresses(self, s: str) -> List[str]:
        res = []
        # A valid IP address has between 4 and 12 digits.
        if len(s) < 4 or len(s) > 12:
            return res
            
        def backtrack(start: int, path: List[str]):
            # If we've found exactly 4 segments, check if we've used all characters in s.
            if len(path) == 4:
                if start == len(s):
                    res.append(".".join(path))
                return
            
            # Each segment of an IP address can be 1, 2, or 3 digits long.
            for length in range(1, 4):
                # Ensure we don't extract characters beyond the end of the string.
                if start + length <= len(s):
                    segment = s[start : start + length]
                    
                    # Rule 1: A segment cannot have leading zeros unless it is "0".
                    # Check: if the segment length is > 1, the first digit cannot be '0'.
                    if len(segment) > 1 and segment[0] == '0':
                        continue
                    
                    # Rule 2: Each integer must be between 0 and 255 inclusive.
                    if int(segment) <= 255:
                        # Continue recursion to find the next segment.
                        # Using path + [segment] creates a new list for each branch.
                        backtrack(start + length, path + [segment])
        
        # Start the recursive search from the beginning of the string with an empty path.
        backtrack(0, [])
        return res
