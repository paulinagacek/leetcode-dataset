# Definition for a binary tree node.
# class TreeNode:
#     def __init__(self, val=0, left=None, right=None):
#         self.val = val
#         self.left = left
#         self.right = right

class Solution:
    def buildTree(self, preorder: List[int], inorder: List[int]) -> Optional[TreeNode]:
        def index(value: int, array: List[int]) -> int:
            for i in range(len(array)):
                if value == array[i]:
                    return i
            return -1

        def create_tree(left_p: int, right_p: int, left_i: int, right_i: int) -> Optional[TreeNode]:
            nonlocal pre_idx
            if left_p > right_p or left_i > right_i:
                return None

            root_value = preorder[pre_idx]
            root = TreeNode(root_value)

            mid_idx = index(root_value, inorder)
            pre_idx += 1

            root.left = create_tree(left_p, mid_idx - 1, left_i, mid_idx - 1)
            root.right = create_tree(mid_idx - left_i + pre_idx, right_p, mid_idx + 1, right_i)

            return root

        pre_idx = 0
        n = len(preorder)
        return create_tree(0, n - 1, 0, n - 1)
