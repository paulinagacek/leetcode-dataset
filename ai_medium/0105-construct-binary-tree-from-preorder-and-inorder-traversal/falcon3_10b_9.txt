class Solution:
    def buildTree(self, preorder: List[int], inorder: List[int]) -> Optional[TreeNode]:
        def helper(in_start, in_end):
            if in_start > in_end:
                return None
            
            node = TreeNode(preorder[idx])
            idx += 1
            if in_start == in_end:
                return node
            
            in_mid = index_map[node.val]
            node.left = helper(in_start, in_mid - 1)
            node.right = helper(in_mid + 1, in_end)
            return node

        idx, index_map = 0, {val: idx for idx, val in enumerate(inorder)}
        return helper(0, len(inorder) - 1)
