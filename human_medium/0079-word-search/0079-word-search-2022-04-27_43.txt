class Solution:
    def exist(self, board: List[List[str]], word: str) -> bool:
        preWord = self.getPreWord(word)
        for i in range(len(board)):
            for j in range(len(board[0])):
                path = board[i][j]
                visited = set([(i, j)])
                if self.dfs(i, j, board, preWord, word, path, visited):
                    return True
        return False
    
    def dfs(self, i, j, board, preWord, word, path, visited):
        
        if path == word:
            return True
        
        if path not in preWord:
            return False
        
        for dx, dy in DIRECTIONS:
            x = i + dx
            y = j + dy
            if (x, y) in visited:
                continue
            if not (0 <= x < len(board) and 0 <= y < len(board[0])):
                continue
            path = path + board[x][y]
            visited.add((x, y))
            if self.dfs(x, y, board, preWord, word, path, visited):
                return True
            path = path[:-1]
            visited.remove((x, y))
        
        return False
    
    def getPreWord(self, word):
        res = set()
        for i in range(1, len(word)):
            res.add(word[:i])
        return res
