class Solution:
    def sortedListToBST(self, head: Optional[ListNode]) -> Optional[TreeNode]:

        if not head: return None

        def dfs(node):

            if not node:
                return None
            slow = node
            fast = node
            prev = None
            while fast and fast.next:
                slow_next = slow.next
                fast_next = fast.next.next
                slow.next = prev
                prev = slow
                # print(slow_next.val if slow_next else None, fast_next.val if slow_next else None )
                slow = slow_next
                fast = fast_next
    
            right = slow.next
            slow.next = None

            left = None
            while prev:
                temp = prev.next
                prev.next = left
                left = prev
                prev = temp


            new_node = TreeNode(slow.val)
            new_node.left = dfs(left)
            new_node.right = dfs(right)

            return new_node
            

        return dfs(head)
