class Solution:
    def search(self, nums: List[int], target: int) -> int:
        
        def findPeakIndex(nums):
            # use binary search to find the max value\'s index
            left, right = 0, len(nums)-1
            if len(nums)==1:
                return 0
            if nums[0] < nums[-1]:
                return len(nums)-1
            
            while left < right:
                mid = left + (right-left)//2
                
                if nums[mid] > nums[mid+1]:
                    return mid
                
                if nums[mid] < nums[left]: # if mid is smaller than left, max is on the left hand side
                    right = mid
                else: # mid is greater than left, then max is on the right hand side
                    left = mid +1
            
        def binarySearch(nums, target, shift):
            # given a monotonically increasing list, find the index of target + shift
            # return -1 if target does not exist
            
            left, right = 0, len(nums)
            
            while left < right:
                mid = left + (right-left)//2

                if nums[mid] == target:
                    return mid + shift

                if nums[mid] > target:
                    right = mid
                else:
                    left = mid+1
            return -1   
            
        
        peak = findPeakIndex(nums)
        left_nums = nums[0:peak+1]
        right_nums = nums[peak+1:]

        if target >= nums[0] and target <= nums[peak]:
            return binarySearch(left_nums, target, 0)
        else:
            return binarySearch(right_nums, target, peak+1)
